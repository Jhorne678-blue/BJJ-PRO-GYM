<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BJJ Pro Gym - Professional Management System</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #312e81 50%, #1e1b4b 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .glass-button {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(147, 51, 234, 0.8));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .glass-button:hover {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.9), rgba(147, 51, 234, 0.9));
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        input[type="text"], input[type="email"], input[type="tel"], input[type="password"],
        input[type="time"], input[type="date"], input[type="number"], textarea, select {
            background-color: white !important;
            color: #1f2937 !important;
            border: 2px solid #e5e7eb !important;
            border-radius: 8px !important;
            padding: 12px 16px !important;
            font-size: 16px !important;
            min-height: 50px !important;
            width: 100% !important;
            box-sizing: border-box !important;
            -webkit-appearance: none !important;
            font-family: 'Inter', sans-serif !important;
        }

        input:focus, textarea:focus, select:focus {
            border-color: #3b82f6 !important;
            outline: none !important;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1) !important;
        }

        select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e") !important;
            background-position: right 12px center !important;
            background-repeat: no-repeat !important;
            background-size: 16px 16px !important;
            padding-right: 40px !important;
        }

        button {
            min-height: 50px !important;
            padding: 12px 24px !important;
            font-size: 16px !important;
            border-radius: 8px !important;
            font-weight: 600 !important;
            border: none !important;
            cursor: pointer !important;
            font-family: 'Inter', sans-serif !important;
            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;
            transition: all 0.3s ease !important;
        }

        .pro-badge {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: #1f2937;
            font-weight: 700;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-block;
        }

        .belt-white { background: linear-gradient(135deg, #ffffff, #f3f4f6); color: #1f2937; }
        .belt-blue { background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; }
        .belt-purple { background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; }
        .belt-brown { background: linear-gradient(135deg, #92400e, #78350f); color: white; }
        .belt-black { background: linear-gradient(135deg, #1f2937, #111827); color: white; }

        .success-pulse {
            animation: successPulse 0.6s ease-out;
        }

        @keyframes successPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .glass-effect {
                margin: 8px;
                border-radius: 12px;
            }

            h1 {
                font-size: 1.8rem !important;
            }

            h2 {
                font-size: 1.5rem !important;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // API Configuration
        const API_BASE_URL = window.location.origin;

        // API Utility Functions
        const apiCall = async (endpoint, options = {}) => {
            const token = localStorage.getItem('auth_token');
            const headers = {
                'Content-Type': 'application/json',
                ...(token && { 'Authorization': `Bearer ${token}` }),
                ...options.headers
            };

            const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                ...options,
                headers
            });

            if (!response.ok) {
                const error = await response.json().catch(() => ({ detail: 'Request failed' }));
                throw new Error(error.detail || 'Request failed');
            }

            return response.json();
        };

        // Login Component
        const Login = ({ onLogin }) => {
            const [email, setEmail] = useState('demo@bjjprogym.com');
            const [password, setPassword] = useState('Admin123!');
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState('');

            const handleLogin = async (e) => {
                e.preventDefault();
                setIsLoading(true);
                setError('');

                try {
                    const data = await apiCall('/api/login', {
                        method: 'POST',
                        body: JSON.stringify({ email, password })
                    });

                    localStorage.setItem('auth_token', data.access_token);
                    localStorage.setItem('gym_info', JSON.stringify(data.gym_info));
                    onLogin(data.gym_info);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setIsLoading(false);
                }
            };

            return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    <div className="glass-effect rounded-3xl p-8 w-full max-w-md">
                        <div className="text-center mb-8">
                            <h1 className="text-3xl font-bold text-white mb-2">ü•ã BJJ PRO GYM</h1>
                            <div className="pro-badge mx-auto mb-4">Professional Edition</div>
                            <p className="text-blue-100 text-sm">Brazilian Jiu-Jitsu Management System</p>
                        </div>

                        <form onSubmit={handleLogin} className="space-y-4">
                            <div>
                                <label className="block text-blue-100 text-sm font-medium mb-2">
                                    Email
                                </label>
                                <input
                                    type="email"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    placeholder="Enter your email"
                                    required
                                />
                            </div>

                            <div>
                                <label className="block text-blue-100 text-sm font-medium mb-2">
                                    Password
                                </label>
                                <input
                                    type="password"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    placeholder="Enter your password"
                                    required
                                />
                            </div>

                            {error && (
                                <div className="bg-red-500 bg-opacity-20 border border-red-300 text-red-100 px-4 py-3 rounded-lg text-sm">
                                    {error}
                                </div>
                            )}

                            <button
                                type="submit"
                                disabled={isLoading}
                                className="glass-button w-full text-white font-semibold"
                            >
                                {isLoading ? 'Logging in...' : 'Login'}
                            </button>

                            <div className="text-center text-blue-200 text-xs mt-4">
                                <p>Demo Account: demo@bjjprogym.com / Admin123!</p>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        // Loading Component
        const Loading = () => (
            <div className="flex items-center justify-center p-8">
                <div className="loading-spinner"></div>
            </div>
        );

        // Student Management Component
        const StudentManagement = () => {
            const [students, setStudents] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState('');
            const [success, setSuccess] = useState('');
            const [showAddForm, setShowAddForm] = useState(false);
            const [newStudent, setNewStudent] = useState({
                name: '',
                email: '',
                phone: '',
                belt_level: 'White'
            });

            const fetchStudents = async () => {
                try {
                    setLoading(true);
                    const data = await apiCall('/api/students');
                    setStudents(data.students);
                    setError('');
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                fetchStudents();
            }, []);

            const handleAddStudent = async (e) => {
                e.preventDefault();
                try {
                    await apiCall('/api/students', {
                        method: 'POST',
                        body: JSON.stringify(newStudent)
                    });
                    setSuccess('Student added successfully!');
                    setNewStudent({ name: '', email: '', phone: '', belt_level: 'White' });
                    setShowAddForm(false);
                    fetchStudents();
                    setTimeout(() => setSuccess(''), 3000);
                } catch (err) {
                    setError(err.message);
                }
            };

            const handleDeleteStudent = async (studentId, studentName) => {
                if (!window.confirm(`Delete "${studentName}"?`)) return;

                try {
                    await apiCall(`/api/students/${studentId}`, {
                        method: 'DELETE'
                    });
                    setSuccess('Student deleted successfully!');
                    fetchStudents();
                    setTimeout(() => setSuccess(''), 3000);
                } catch (err) {
                    setError(err.message);
                }
            };

            const belts = ['White', 'Blue', 'Purple', 'Brown', 'Black'];

            return (
                <div className="space-y-4">
                    <div className="flex justify-between items-center">
                        <h2 className="text-2xl font-bold text-white">üë• Students</h2>
                        <button
                            onClick={() => setShowAddForm(true)}
                            className="glass-button px-4 py-2 text-white font-semibold text-sm"
                        >
                            ‚ûï Add Student
                        </button>
                    </div>

                    {success && (
                        <div className="bg-green-500 bg-opacity-20 border border-green-300 text-green-100 px-4 py-3 rounded-lg success-pulse">
                            {success}
                        </div>
                    )}

                    {error && (
                        <div className="bg-red-500 bg-opacity-20 border border-red-300 text-red-100 px-4 py-3 rounded-lg">
                            {error}
                        </div>
                    )}

                    {loading ? (
                        <Loading />
                    ) : (
                        <div className="glass-effect rounded-xl p-4">
                            <h3 className="text-sm font-semibold text-white mb-4">
                                Total Students: {students.length}
                            </h3>
                            <div className="space-y-3">
                                {students.map((student) => (
                                    <div key={student.id} className="bg-white bg-opacity-10 rounded-lg p-4 hover:bg-opacity-20 transition-all">
                                        <div className="flex justify-between items-start">
                                            <div className="flex-1">
                                                <h4 className="font-bold text-white mb-2">{student.name}</h4>
                                                <div className="text-blue-100 text-sm space-y-1">
                                                    <div>üìß {student.email || 'N/A'}</div>
                                                    <div>üì± {student.phone || 'N/A'}</div>
                                                    <div>ü•ã <span className={`belt-${student.belt_level.toLowerCase()} px-2 py-1 rounded`}>
                                                        {student.belt_level} Belt
                                                    </span></div>
                                                    <div>üÜî {student.member_id}</div>
                                                    <div>üé´ {student.card_number}</div>
                                                </div>
                                            </div>
                                            <button
                                                onClick={() => handleDeleteStudent(student.id, student.name)}
                                                className="bg-red-500 bg-opacity-20 px-3 py-2 text-red-100 rounded hover:bg-opacity-40"
                                            >
                                                üóëÔ∏è
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {showAddForm && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                            <div className="glass-effect rounded-xl p-6 w-full max-w-md">
                                <h3 className="text-lg font-bold text-white mb-4">Add New Student</h3>
                                <form onSubmit={handleAddStudent} className="space-y-4">
                                    <div>
                                        <label className="block text-blue-100 text-sm font-medium mb-2">Name *</label>
                                        <input
                                            type="text"
                                            value={newStudent.name}
                                            onChange={(e) => setNewStudent({...newStudent, name: e.target.value})}
                                            required
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-blue-100 text-sm font-medium mb-2">Email</label>
                                        <input
                                            type="email"
                                            value={newStudent.email}
                                            onChange={(e) => setNewStudent({...newStudent, email: e.target.value})}
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-blue-100 text-sm font-medium mb-2">Phone</label>
                                        <input
                                            type="tel"
                                            value={newStudent.phone}
                                            onChange={(e) => setNewStudent({...newStudent, phone: e.target.value})}
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-blue-100 text-sm font-medium mb-2">Belt Level</label>
                                        <select
                                            value={newStudent.belt_level}
                                            onChange={(e) => setNewStudent({...newStudent, belt_level: e.target.value})}
                                        >
                                            {belts.map(belt => (
                                                <option key={belt} value={belt}>{belt}</option>
                                            ))}
                                        </select>
                                    </div>
                                    <div className="flex gap-3">
                                        <button type="submit" className="glass-button flex-1 text-white font-semibold">
                                            Add Student
                                        </button>
                                        <button
                                            type="button"
                                            onClick={() => setShowAddForm(false)}
                                            className="bg-gray-500 bg-opacity-20 flex-1 text-white font-semibold hover:bg-opacity-30"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Class Management Component
        const ClassManagement = () => {
            const [classes, setClasses] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState('');
            const [success, setSuccess] = useState('');
            const [showAddForm, setShowAddForm] = useState(false);
            const [newClass, setNewClass] = useState({ name: '', description: '' });

            const fetchClasses = async () => {
                try {
                    setLoading(true);
                    const data = await apiCall('/api/classes');
                    setClasses(data.classes);
                    setError('');
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                fetchClasses();
            }, []);

            const handleAddClass = async (e) => {
                e.preventDefault();
                try {
                    await apiCall('/api/classes', {
                        method: 'POST',
                        body: JSON.stringify(newClass)
                    });
                    setSuccess('Class added successfully!');
                    setNewClass({ name: '', description: '' });
                    setShowAddForm(false);
                    fetchClasses();
                    setTimeout(() => setSuccess(''), 3000);
                } catch (err) {
                    setError(err.message);
                }
            };

            const handleDeleteClass = async (classId, className) => {
                if (!window.confirm(`Delete "${className}"?`)) return;

                try {
                    await apiCall(`/api/classes/${classId}`, {
                        method: 'DELETE'
                    });
                    setSuccess('Class deleted successfully!');
                    fetchClasses();
                    setTimeout(() => setSuccess(''), 3000);
                } catch (err) {
                    setError(err.message);
                }
            };

            return (
                <div className="space-y-4">
                    <div className="flex justify-between items-center">
                        <h2 className="text-2xl font-bold text-white">üìö Classes</h2>
                        <button
                            onClick={() => setShowAddForm(true)}
                            className="glass-button px-4 py-2 text-white font-semibold text-sm"
                        >
                            ‚ûï Add Class
                        </button>
                    </div>

                    {success && (
                        <div className="bg-green-500 bg-opacity-20 border border-green-300 text-green-100 px-4 py-3 rounded-lg success-pulse">
                            {success}
                        </div>
                    )}

                    {error && (
                        <div className="bg-red-500 bg-opacity-20 border border-red-300 text-red-100 px-4 py-3 rounded-lg">
                            {error}
                        </div>
                    )}

                    {loading ? (
                        <Loading />
                    ) : (
                        <div className="glass-effect rounded-xl p-4">
                            <h3 className="text-sm font-semibold text-white mb-4">
                                Total Classes: {classes.length}
                            </h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                {classes.map((classItem) => (
                                    <div key={classItem.id} className="bg-white bg-opacity-10 rounded-lg p-4 hover:bg-opacity-20">
                                        <div className="flex justify-between items-start mb-2">
                                            <h4 className="font-bold text-white">{classItem.name}</h4>
                                            <button
                                                onClick={() => handleDeleteClass(classItem.id, classItem.name)}
                                                className="bg-red-500 bg-opacity-20 px-2 py-1 text-red-100 rounded hover:bg-opacity-40"
                                            >
                                                üóëÔ∏è
                                            </button>
                                        </div>
                                        <p className="text-blue-100 text-sm">{classItem.description || 'No description'}</p>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {showAddForm && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                            <div className="glass-effect rounded-xl p-6 w-full max-w-md">
                                <h3 className="text-lg font-bold text-white mb-4">Add New Class</h3>
                                <form onSubmit={handleAddClass} className="space-y-4">
                                    <div>
                                        <label className="block text-blue-100 text-sm font-medium mb-2">Class Name *</label>
                                        <input
                                            type="text"
                                            value={newClass.name}
                                            onChange={(e) => setNewClass({...newClass, name: e.target.value})}
                                            required
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-blue-100 text-sm font-medium mb-2">Description</label>
                                        <textarea
                                            value={newClass.description}
                                            onChange={(e) => setNewClass({...newClass, description: e.target.value})}
                                            rows="3"
                                        />
                                    </div>
                                    <div className="flex gap-3">
                                        <button type="submit" className="glass-button flex-1 text-white font-semibold">
                                            Add Class
                                        </button>
                                        <button
                                            type="button"
                                            onClick={() => setShowAddForm(false)}
                                            className="bg-gray-500 bg-opacity-20 flex-1 text-white font-semibold hover:bg-opacity-30"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Schedule Management Component
        const ScheduleManagement = () => {
            const [schedules, setSchedules] = useState([]);
            const [classes, setClasses] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState('');
            const [success, setSuccess] = useState('');
            const [showAddForm, setShowAddForm] = useState(false);
            const [newSchedule, setNewSchedule] = useState({
                class_name: '',
                day_of_week: 0,
                start_time: '18:00',
                end_time: '19:00',
                instructor: ''
            });

            const daysOfWeek = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];

            const fetchData = async () => {
                try {
                    setLoading(true);
                    const [schedulesData, classesData] = await Promise.all([
                        apiCall('/api/schedules'),
                        apiCall('/api/classes')
                    ]);
                    setSchedules(schedulesData.schedules);
                    setClasses(classesData.classes);
                    setError('');
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                fetchData();
            }, []);

            const handleAddSchedule = async (e) => {
                e.preventDefault();
                try {
                    await apiCall('/api/schedules', {
                        method: 'POST',
                        body: JSON.stringify(newSchedule)
                    });
                    setSuccess('Schedule added successfully!');
                    setNewSchedule({
                        class_name: '',
                        day_of_week: 0,
                        start_time: '18:00',
                        end_time: '19:00',
                        instructor: ''
                    });
                    setShowAddForm(false);
                    fetchData();
                    setTimeout(() => setSuccess(''), 3000);
                } catch (err) {
                    setError(err.message);
                }
            };

            const handleDeleteSchedule = async (scheduleId) => {
                if (!window.confirm('Delete this schedule?')) return;

                try {
                    await apiCall(`/api/schedules/${scheduleId}`, {
                        method: 'DELETE'
                    });
                    setSuccess('Schedule deleted successfully!');
                    fetchData();
                    setTimeout(() => setSuccess(''), 3000);
                } catch (err) {
                    setError(err.message);
                }
            };

            const formatTime = (time) => {
                const [hours, minutes] = time.split(':');
                const hour = parseInt(hours);
                const ampm = hour >= 12 ? 'PM' : 'AM';
                const displayHour = hour === 0 ? 12 : hour > 12 ? hour - 12 : hour;
                return `${displayHour}:${minutes} ${ampm}`;
            };

            return (
                <div className="space-y-4">
                    <div className="flex justify-between items-center">
                        <h2 className="text-2xl font-bold text-white">üìÖ Schedule</h2>
                        <button
                            onClick={() => setShowAddForm(true)}
                            className="glass-button px-4 py-2 text-white font-semibold text-sm"
                        >
                            ‚ûï Add Schedule
                        </button>
                    </div>

                    {success && (
                        <div className="bg-green-500 bg-opacity-20 border border-green-300 text-green-100 px-4 py-3 rounded-lg success-pulse">
                            {success}
                        </div>
                    )}

                    {error && (
                        <div className="bg-red-500 bg-opacity-20 border border-red-300 text-red-100 px-4 py-3 rounded-lg">
                            {error}
                        </div>
                    )}

                    {loading ? (
                        <Loading />
                    ) : (
                        <div className="glass-effect rounded-xl p-4">
                            <h3 className="text-sm font-semibold text-white mb-4">Weekly Schedule</h3>
                            <div className="space-y-3">
                                {daysOfWeek.map((day, dayIndex) => {
                                    const daySchedules = schedules
                                        .filter(s => s.day_of_week === dayIndex)
                                        .sort((a, b) => a.start_time.localeCompare(b.start_time));

                                    return (
                                        <div key={day} className="bg-white bg-opacity-5 rounded-lg p-3">
                                            <h4 className="font-semibold text-white text-sm mb-2">{day}</h4>
                                            {daySchedules.length === 0 ? (
                                                <div className="text-blue-300 text-xs">No classes scheduled</div>
                                            ) : (
                                                <div className="space-y-2">
                                                    {daySchedules.map((schedule) => (
                                                        <div key={schedule.id} className="bg-white bg-opacity-10 rounded-lg p-2 flex justify-between items-center">
                                                            <div className="flex-1">
                                                                <div className="font-medium text-white text-sm">{schedule.class_name}</div>
                                                                <div className="text-blue-200 text-xs">
                                                                    {formatTime(schedule.start_time)} - {formatTime(schedule.end_time)}
                                                                </div>
                                                                {schedule.instructor && (
                                                                    <div className="text-blue-300 text-xs">
                                                                        üë®‚Äçüè´ {schedule.instructor}
                                                                    </div>
                                                                )}
                                                            </div>
                                                            <button
                                                                onClick={() => handleDeleteSchedule(schedule.id)}
                                                                className="bg-red-500 bg-opacity-20 px-2 py-1 text-red-100 rounded text-xs hover:bg-opacity-40"
                                                            >
                                                                üóëÔ∏è
                                                            </button>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    )}

                    {showAddForm && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                            <div className="glass-effect rounded-xl p-6 w-full max-w-md">
                                <h3 className="text-lg font-bold text-white mb-4">Add New Schedule</h3>
                                <form onSubmit={handleAddSchedule} className="space-y-4">
                                    <div>
                                        <label className="block text-blue-100 text-sm font-medium mb-2">Class *</label>
                                        <select
                                            value={newSchedule.class_name}
                                            onChange={(e) => setNewSchedule({...newSchedule, class_name: e.target.value})}
                                            required
                                        >
                                            <option value="">Select a class</option>
                                            {classes.map(cls => (
                                                <option key={cls.id} value={cls.name}>{cls.name}</option>
                                            ))}
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-blue-100 text-sm font-medium mb-2">Day of Week *</label>
                                        <select
                                            value={newSchedule.day_of_week}
                                            onChange={(e) => setNewSchedule({...newSchedule, day_of_week: parseInt(e.target.value)})}
                                            required
                                        >
                                            {daysOfWeek.map((day, index) => (
                                                <option key={index} value={index}>{day}</option>
                                            ))}
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-blue-100 text-sm font-medium mb-2">Start Time *</label>
                                        <input
                                            type="time"
                                            value={newSchedule.start_time}
                                            onChange={(e) => setNewSchedule({...newSchedule, start_time: e.target.value})}
                                            required
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-blue-100 text-sm font-medium mb-2">End Time *</label>
                                        <input
                                            type="time"
                                            value={newSchedule.end_time}
                                            onChange={(e) => setNewSchedule({...newSchedule, end_time: e.target.value})}
                                            required
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-blue-100 text-sm font-medium mb-2">Instructor</label>
                                        <input
                                            type="text"
                                            value={newSchedule.instructor}
                                            onChange={(e) => setNewSchedule({...newSchedule, instructor: e.target.value})}
                                        />
                                    </div>
                                    <div className="flex gap-3">
                                        <button type="submit" className="glass-button flex-1 text-white font-semibold">
                                            Add Schedule
                                        </button>
                                        <button
                                            type="button"
                                            onClick={() => setShowAddForm(false)}
                                            className="bg-gray-500 bg-opacity-20 flex-1 text-white font-semibold hover:bg-opacity-30"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Attendance Component
        const AttendanceManagement = () => {
            const [attendance, setAttendance] = useState([]);
            const [students, setStudents] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState('');
            const [success, setSuccess] = useState('');
            const [showCheckInForm, setShowCheckInForm] = useState(false);
            const [selectedStudent, setSelectedStudent] = useState('');

            const fetchData = async () => {
                try {
                    setLoading(true);
                    const [attendanceData, studentsData] = await Promise.all([
                        apiCall('/api/attendance'),
                        apiCall('/api/students')
                    ]);
                    setAttendance(attendanceData.attendance);
                    setStudents(studentsData.students);
                    setError('');
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                fetchData();
            }, []);

            const handleCheckIn = async (e) => {
                e.preventDefault();
                try {
                    const student = students.find(s => s.id === parseInt(selectedStudent));
                    await apiCall('/api/attendance/checkin', {
                        method: 'POST',
                        body: JSON.stringify({ student_name: student.name })
                    });
                    setSuccess(`${student.name} checked in successfully!`);
                    setSelectedStudent('');
                    setShowCheckInForm(false);
                    fetchData();
                    setTimeout(() => setSuccess(''), 3000);
                } catch (err) {
                    setError(err.message);
                }
            };

            return (
                <div className="space-y-4">
                    <div className="flex justify-between items-center">
                        <h2 className="text-2xl font-bold text-white">‚úÖ Attendance</h2>
                        <button
                            onClick={() => setShowCheckInForm(true)}
                            className="glass-button px-4 py-2 text-white font-semibold text-sm"
                        >
                            ‚ûï Check In Student
                        </button>
                    </div>

                    {success && (
                        <div className="bg-green-500 bg-opacity-20 border border-green-300 text-green-100 px-4 py-3 rounded-lg success-pulse">
                            {success}
                        </div>
                    )}

                    {error && (
                        <div className="bg-red-500 bg-opacity-20 border border-red-300 text-red-100 px-4 py-3 rounded-lg">
                            {error}
                        </div>
                    )}

                    {loading ? (
                        <Loading />
                    ) : (
                        <div className="glass-effect rounded-xl p-4">
                            <h3 className="text-sm font-semibold text-white mb-4">
                                Recent Check-Ins: {attendance.length}
                            </h3>
                            <div className="space-y-2">
                                {attendance.map((record) => (
                                    <div key={record.id} className="bg-white bg-opacity-10 rounded-lg p-3">
                                        <div className="flex justify-between items-center">
                                            <div>
                                                <div className="font-semibold text-white">{record.student_name}</div>
                                                <div className="text-blue-200 text-sm">{record.class_name}</div>
                                                <div className="text-blue-300 text-xs">
                                                    {new Date(record.check_in_time).toLocaleString()}
                                                </div>
                                            </div>
                                            <div className="text-green-400 text-2xl">‚úì</div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {showCheckInForm && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                            <div className="glass-effect rounded-xl p-6 w-full max-w-md">
                                <h3 className="text-lg font-bold text-white mb-4">Check In Student</h3>
                                <form onSubmit={handleCheckIn} className="space-y-4">
                                    <div>
                                        <label className="block text-blue-100 text-sm font-medium mb-2">Select Student *</label>
                                        <select
                                            value={selectedStudent}
                                            onChange={(e) => setSelectedStudent(e.target.value)}
                                            required
                                        >
                                            <option value="">Select a student</option>
                                            {students.map(student => (
                                                <option key={student.id} value={student.id}>
                                                    {student.name} ({student.member_id})
                                                </option>
                                            ))}
                                        </select>
                                    </div>
                                    <div className="flex gap-3">
                                        <button type="submit" className="glass-button flex-1 text-white font-semibold">
                                            Check In
                                        </button>
                                        <button
                                            type="button"
                                            onClick={() => setShowCheckInForm(false)}
                                            className="bg-gray-500 bg-opacity-20 flex-1 text-white font-semibold hover:bg-opacity-30"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Payments Component
        const PaymentsManagement = () => {
            const [payments, setPayments] = useState([]);
            const [students, setStudents] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState('');
            const [success, setSuccess] = useState('');
            const [showAddForm, setShowAddForm] = useState(false);
            const [newPayment, setNewPayment] = useState({
                student_name: '',
                member_id: '',
                amount: '',
                payment_type: 'Monthly Membership',
                payment_method: 'Credit Card'
            });

            const fetchData = async () => {
                try {
                    setLoading(true);
                    const [paymentsData, studentsData] = await Promise.all([
                        apiCall('/api/payments'),
                        apiCall('/api/students')
                    ]);
                    setPayments(paymentsData.payments);
                    setStudents(studentsData.students);
                    setError('');
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                fetchData();
            }, []);

            const handleAddPayment = async (e) => {
                e.preventDefault();
                try {
                    await apiCall('/api/payments', {
                        method: 'POST',
                        body: JSON.stringify(newPayment)
                    });
                    setSuccess('Payment recorded successfully!');
                    setNewPayment({
                        student_name: '',
                        member_id: '',
                        amount: '',
                        payment_type: 'Monthly Membership',
                        payment_method: 'Credit Card'
                    });
                    setShowAddForm(false);
                    fetchData();
                    setTimeout(() => setSuccess(''), 3000);
                } catch (err) {
                    setError(err.message);
                }
            };

            const handleStudentSelect = (studentId) => {
                const student = students.find(s => s.id === parseInt(studentId));
                if (student) {
                    setNewPayment({
                        ...newPayment,
                        student_name: student.name,
                        member_id: student.member_id
                    });
                }
            };

            const totalRevenue = payments.reduce((sum, p) => sum + parseFloat(p.amount || 0), 0);

            return (
                <div className="space-y-4">
                    <div className="flex justify-between items-center">
                        <h2 className="text-2xl font-bold text-white">üí∞ Payments</h2>
                        <button
                            onClick={() => setShowAddForm(true)}
                            className="glass-button px-4 py-2 text-white font-semibold text-sm"
                        >
                            ‚ûï Record Payment
                        </button>
                    </div>

                    {success && (
                        <div className="bg-green-500 bg-opacity-20 border border-green-300 text-green-100 px-4 py-3 rounded-lg success-pulse">
                            {success}
                        </div>
                    )}

                    {error && (
                        <div className="bg-red-500 bg-opacity-20 border border-red-300 text-red-100 px-4 py-3 rounded-lg">
                            {error}
                        </div>
                    )}

                    {loading ? (
                        <Loading />
                    ) : (
                        <>
                            <div className="glass-effect rounded-xl p-4">
                                <div className="text-center">
                                    <div className="text-4xl font-bold text-white mb-2">
                                        ${totalRevenue.toFixed(2)}
                                    </div>
                                    <div className="text-blue-200 text-sm">Total Revenue</div>
                                </div>
                            </div>

                            <div className="glass-effect rounded-xl p-4">
                                <h3 className="text-sm font-semibold text-white mb-4">
                                    Payment History: {payments.length}
                                </h3>
                                <div className="space-y-2">
                                    {payments.map((payment) => (
                                        <div key={payment.id} className="bg-white bg-opacity-10 rounded-lg p-3">
                                            <div className="flex justify-between items-start">
                                                <div className="flex-1">
                                                    <div className="font-semibold text-white">{payment.student_name}</div>
                                                    <div className="text-blue-200 text-sm">{payment.payment_type}</div>
                                                    <div className="text-blue-300 text-xs">
                                                        {new Date(payment.payment_date).toLocaleDateString()} ‚Ä¢ {payment.payment_method}
                                                    </div>
                                                </div>
                                                <div className="text-green-400 font-bold">
                                                    ${parseFloat(payment.amount).toFixed(2)}
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </>
                    )}

                    {showAddForm && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                            <div className="glass-effect rounded-xl p-6 w-full max-w-md">
                                <h3 className="text-lg font-bold text-white mb-4">Record Payment</h3>
                                <form onSubmit={handleAddPayment} className="space-y-4">
                                    <div>
                                        <label className="block text-blue-100 text-sm font-medium mb-2">Select Student *</label>
                                        <select
                                            onChange={(e) => handleStudentSelect(e.target.value)}
                                            required
                                        >
                                            <option value="">Select a student</option>
                                            {students.map(student => (
                                                <option key={student.id} value={student.id}>
                                                    {student.name} ({student.member_id})
                                                </option>
                                            ))}
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-blue-100 text-sm font-medium mb-2">Amount *</label>
                                        <input
                                            type="number"
                                            step="0.01"
                                            value={newPayment.amount}
                                            onChange={(e) => setNewPayment({...newPayment, amount: e.target.value})}
                                            required
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-blue-100 text-sm font-medium mb-2">Payment Type</label>
                                        <select
                                            value={newPayment.payment_type}
                                            onChange={(e) => setNewPayment({...newPayment, payment_type: e.target.value})}
                                        >
                                            <option>Monthly Membership</option>
                                            <option>Annual Membership</option>
                                            <option>Drop-in Class</option>
                                            <option>Private Lesson</option>
                                            <option>Gear Purchase</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-blue-100 text-sm font-medium mb-2">Payment Method</label>
                                        <select
                                            value={newPayment.payment_method}
                                            onChange={(e) => setNewPayment({...newPayment, payment_method: e.target.value})}
                                        >
                                            <option>Credit Card</option>
                                            <option>Debit Card</option>
                                            <option>Cash</option>
                                            <option>Bank Transfer</option>
                                            <option>Check</option>
                                        </select>
                                    </div>
                                    <div className="flex gap-3">
                                        <button type="submit" className="glass-button flex-1 text-white font-semibold">
                                            Record Payment
                                        </button>
                                        <button
                                            type="button"
                                            onClick={() => setShowAddForm(false)}
                                            className="bg-gray-500 bg-opacity-20 flex-1 text-white font-semibold hover:bg-opacity-30"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Analytics Component
        const AnalyticsDashboard = () => {
            const [analytics, setAnalytics] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState('');

            const fetchAnalytics = async () => {
                try {
                    setLoading(true);
                    const data = await apiCall('/api/analytics');
                    setAnalytics(data);
                    setError('');
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                fetchAnalytics();
                const interval = setInterval(fetchAnalytics, 30000); // Refresh every 30 seconds
                return () => clearInterval(interval);
            }, []);

            if (loading) return <Loading />;
            if (error) return <div className="text-red-300">Error: {error}</div>;
            if (!analytics) return null;

            return (
                <div className="space-y-4">
                    <h2 className="text-2xl font-bold text-white">üìä Analytics</h2>

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div className="glass-effect rounded-xl p-4 text-center">
                            <div className="text-3xl font-bold text-white">{analytics.summary.total_students}</div>
                            <div className="text-blue-200 text-sm">Total Students</div>
                        </div>
                        <div className="glass-effect rounded-xl p-4 text-center">
                            <div className="text-3xl font-bold text-green-400">${analytics.summary.monthly_revenue.toFixed(2)}</div>
                            <div className="text-blue-200 text-sm">Monthly Revenue</div>
                        </div>
                        <div className="glass-effect rounded-xl p-4 text-center">
                            <div className="text-3xl font-bold text-yellow-400">{analytics.summary.checkins_today}</div>
                            <div className="text-blue-200 text-sm">Check-ins Today</div>
                        </div>
                        <div className="glass-effect rounded-xl p-4 text-center">
                            <div className="text-3xl font-bold text-purple-400">{analytics.summary.active_students}</div>
                            <div className="text-blue-200 text-sm">Active Students (7d)</div>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="glass-effect rounded-xl p-4">
                            <h3 className="text-lg font-semibold text-white mb-3">Belt Distribution</h3>
                            <div className="space-y-2">
                                {Object.entries(analytics.belt_distribution).map(([belt, count]) => (
                                    <div key={belt} className="flex justify-between items-center">
                                        <span className={`belt-${belt.toLowerCase()} px-3 py-1 rounded text-sm`}>
                                            {belt} Belt
                                        </span>
                                        <span className="text-white font-semibold">{count}</span>
                                    </div>
                                ))}
                            </div>
                        </div>

                        <div className="glass-effect rounded-xl p-4">
                            <h3 className="text-lg font-semibold text-white mb-3">Popular Classes (30d)</h3>
                            <div className="space-y-2">
                                {analytics.popular_classes.map((cls, index) => (
                                    <div key={index} className="flex justify-between items-center bg-white bg-opacity-10 rounded p-2">
                                        <span className="text-white">{cls.class_name}</span>
                                        <span className="text-blue-200">{cls.count} visits</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Risk Analysis Component
        const RiskAnalysis = () => {
            const [riskData, setRiskData] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState('');

            const fetchRiskAnalysis = async () => {
                try {
                    setLoading(true);
                    const data = await apiCall('/api/risk-analysis');
                    setRiskData(data);
                    setError('');
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                fetchRiskAnalysis();
            }, []);

            if (loading) return <Loading />;
            if (error) return <div className="text-red-300">Error: {error}</div>;
            if (!riskData) return null;

            return (
                <div className="space-y-4">
                    <h2 className="text-2xl font-bold text-white">‚ö†Ô∏è Risk Analysis</h2>

                    <div className="glass-effect rounded-xl p-4">
                        <h3 className="text-sm font-semibold text-white mb-4">
                            At-Risk Students: {riskData.at_risk_students.length}
                        </h3>
                        <div className="space-y-2">
                            {riskData.at_risk_students.length === 0 ? (
                                <div className="text-green-300 text-center py-8">
                                    üéâ No students at risk! Everyone is actively training.
                                </div>
                            ) : (
                                riskData.at_risk_students.map((student) => (
                                    <div key={student.id} className="bg-white bg-opacity-10 rounded-lg p-3">
                                        <div className="flex justify-between items-start">
                                            <div className="flex-1">
                                                <div className="font-semibold text-white">{student.name}</div>
                                                <div className="text-blue-200 text-sm">
                                                    {student.belt_level} Belt ‚Ä¢ {student.member_id}
                                                </div>
                                                <div className="text-blue-300 text-xs">
                                                    Last Attended: {student.last_attendance ?
                                                        new Date(student.last_attendance).toLocaleDateString() :
                                                        'Never'}
                                                </div>
                                            </div>
                                            <div className={`px-3 py-1 rounded text-xs font-semibold ${
                                                student.risk_level === 'High' ? 'bg-red-500' : 'bg-yellow-500'
                                            } text-white`}>
                                                {student.risk_level} Risk
                                            </div>
                                        </div>
                                        <div className="mt-2 text-yellow-300 text-sm">
                                            {student.days_absent === 999 ?
                                                '‚ö†Ô∏è Has never attended' :
                                                `‚ö†Ô∏è ${student.days_absent} days absent`}
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // Main Dashboard Component
        const Dashboard = ({ gymInfo, onLogout }) => {
            const [activeTab, setActiveTab] = useState('students');

            const tabs = [
                { id: 'students', label: 'üë• Students', component: StudentManagement },
                { id: 'classes', label: 'üìö Classes', component: ClassManagement },
                { id: 'schedule', label: 'üìÖ Schedule', component: ScheduleManagement },
                { id: 'attendance', label: '‚úÖ Attendance', component: AttendanceManagement },
                { id: 'payments', label: 'üí∞ Payments', component: PaymentsManagement },
                { id: 'analytics', label: 'üìä Analytics', component: AnalyticsDashboard },
                { id: 'risk', label: '‚ö†Ô∏è Risk Analysis', component: RiskAnalysis },
            ];

            const ActiveComponent = tabs.find(t => t.id === activeTab)?.component;

            return (
                <div className="min-h-screen p-4">
                    <div className="max-w-7xl mx-auto">
                        <div className="glass-effect rounded-3xl p-6 mb-6">
                            <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                                <div>
                                    <h1 className="text-3xl font-bold text-white mb-2">
                                        ü•ã {gymInfo.gym_name}
                                    </h1>
                                    <div className="pro-badge">Professional Edition</div>
                                </div>
                                <button
                                    onClick={() => {
                                        localStorage.removeItem('auth_token');
                                        localStorage.removeItem('gym_info');
                                        onLogout();
                                    }}
                                    className="bg-red-500 bg-opacity-20 px-4 py-2 text-red-100 rounded-lg hover:bg-opacity-40 text-sm"
                                >
                                    Logout
                                </button>
                            </div>
                        </div>

                        <div className="glass-effect rounded-3xl p-6 mb-6">
                            <div className="flex flex-wrap gap-2">
                                {tabs.map(tab => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setActiveTab(tab.id)}
                                        className={`px-4 py-2 rounded-lg text-sm font-semibold transition-all ${
                                            activeTab === tab.id
                                                ? 'bg-blue-500 text-white'
                                                : 'bg-white bg-opacity-10 text-blue-100 hover:bg-opacity-20'
                                        }`}
                                    >
                                        {tab.label}
                                    </button>
                                ))}
                            </div>
                        </div>

                        <div className="glass-effect rounded-3xl p-6">
                            {ActiveComponent && <ActiveComponent />}
                        </div>
                    </div>
                </div>
            );
        };

        // Main App Component
        const App = () => {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [gymInfo, setGymInfo] = useState(null);

            useEffect(() => {
                const token = localStorage.getItem('auth_token');
                const savedGymInfo = localStorage.getItem('gym_info');
                if (token && savedGymInfo) {
                    setGymInfo(JSON.parse(savedGymInfo));
                    setIsLoggedIn(true);
                }
            }, []);

            const handleLogin = (info) => {
                setGymInfo(info);
                setIsLoggedIn(true);
            };

            const handleLogout = () => {
                setIsLoggedIn(false);
                setGymInfo(null);
            };

            return (
                <>
                    {isLoggedIn ? (
                        <Dashboard gymInfo={gymInfo} onLogout={handleLogout} />
                    ) : (
                        <Login onLogin={handleLogin} />
                    )}
                </>
            );
        };

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
